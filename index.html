<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Ping Pong Refere</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <style media="screen">
      #score {
        font-size: 30px;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid" id="game">
      <div class="row">
        <div class="center-block form-inline">
          <player-name :player="players[0]"></player-name>
          <player-name :player="players[1]"></player-name>
        </div>
      </div>
      <div class="row">
        <div class="col-md-3 col-md-offset-3" id="player1">
          <score :score="players[0].score"></score>
          <button v-on:click="winPoint(players[0], players[1])" type="submit" class="btn btn-lg btn-success" name="player1">Won</button>
        </div>

        <div class="col-md-3">
          <score :score="players[1].score"></score>
          <button v-on:click="winPoint(players[1], players[0])" type="submit" class="btn btn-lg btn-success" name="player2">Won</button>
        </div>
      </div>
      <game-end :player="winner"></game-end>
    </div>

    <script type="text/javascript" src="https://npmcdn.com/vue@1.0.25/dist/vue.min.js"></script>
    <script type="text/javascript">
    Vue.config.vocalServerUrl = "http://192.168.10.155:8888/";

      var ScoreComponent = Vue.extend({
        props: ['score'],
        template: '<div class="score">{{ score }}</div>'
      });

      var PlayerNameComponent = Vue.extend({
        props: ['player'],
        template: '<input type="text" class="form-control col-md-6" v-model="player.name">'
      });

      var GameEndComponent = Vue.extend({
        props: ['player'],
        data: function () {
          return {
            message: ''
          }
        },
        template: '<div v-show="player">{{ message }}</div>',
        computed: {
          won: function () {
            return this.player.name + " a gagné";
          }
        },
        watch: {
          player: function (player) {
            this.message = this.won;

            var xhr = new XMLHttpRequest();
            xhr.open('GET', Vue.config.vocalServerUrl+this.message);
            xhr.send(null);
          }
        }
      });

      Vue.component('score', ScoreComponent);
      Vue.component('player-name', PlayerNameComponent);
      Vue.component('game-end', GameEndComponent);

      new Vue({
        el: '#game',
        data: {
          players : [
            { name: "player1", score: 0},
            { name: "player2", score: 0}
          ],
          winner: null
        },
        methods: {
          winPoint: function (player1, player2) {
            player1.score++;

            var xhr = new XMLHttpRequest();
            xhr.open('GET', Vue.config.vocalServerUrl+this.players[0].score+' à '+this.players[1].score);
            xhr.send(null);

            if (player1.score >= 11 && player1.score - player2.score >= 2) {
              this.winner = player1;
            }
          }
        }
      });
    </script>
  </body>
</html>
